<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Layer-wise SEM train with a Deep Neural Netwok (DNN) — SEMdnn • SEMdeep</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Layer-wise SEM train with a Deep Neural Netwok (DNN) — SEMdnn"><meta property="og:description" content="The function builds the topological layer (TL) ordering
of the input graph to fit a series of Deep Neural Networks (DNN)
models, where the nodes in one layer act as response variables (output)
y and the nodes in the sucessive layers act as predictors (input) x.
Each fit uses the dnn function of the cito R
package, based on the deep learning framework 'torch'.
The torch package is native to R, so it's computationally efficient
and the installation is very simple, as there is no need to install Python
or any other API, and DNNs can be trained on CPU, GPU and MacOS GPUs.
In order to install torch please follow these steps:
install.packages(&quot;torch&quot;)
library(torch)
install_torch(reinstall = TRUE)
For setup GPU or if you have problems installing torch package, check out the
installation
help from the torch developer."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SEMdeep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/BarbaraTarantino/SEMdeep/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Layer-wise SEM train with a Deep Neural Netwok (DNN)</h1>
    <small class="dont-index">Source: <a href="https://github.com/BarbaraTarantino/SEMdeep/blob/HEAD/R/SEMdnn.R" class="external-link"><code>R/SEMdnn.R</code></a></small>
    <div class="hidden name"><code>SEMdnn.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The function builds the topological layer (TL) ordering
of the input graph to fit a series of Deep Neural Networks (DNN)
models, where the nodes in one layer act as response variables (output)
y and the nodes in the sucessive layers act as predictors (input) x.
Each fit uses the <code><a href="https://citoverse.github.io/cito/reference/dnn.html" class="external-link">dnn</a></code> function of the <span class="pkg">cito</span> R
package, based on the deep learning framework 'torch'.</p>
<p>The <span class="pkg">torch</span> package is native to R, so it's computationally efficient
and the installation is very simple, as there is no need to install Python
or any other API, and DNNs can be trained on CPU, GPU and MacOS GPUs.
In order to install <span class="pkg">torch</span> please follow these steps:</p>
<p><code>install.packages("torch")</code></p>
<p><code><a href="https://torch.mlverse.org/docs" class="external-link">library(torch)</a></code></p>
<p><code>install_torch(reinstall = TRUE)</code></p>
<p>For setup GPU or if you have problems installing <span class="pkg">torch</span> package, check out the
<a href="https://torch.mlverse.org/docs/articles/installation.html/" class="external-link">installation</a>
help from the torch developer.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">SEMdnn</span><span class="op">(</span></span>
<span>  <span class="va">graph</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  outcome <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  thr <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nboot <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  hidden <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10L</span>, <span class="fl">10L</span>, <span class="fl">10L</span><span class="op">)</span>,</span>
<span>  link <span class="op">=</span> <span class="st">"relu"</span>,</span>
<span>  bias <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  dropout <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  loss <span class="op">=</span> <span class="st">"mse"</span>,</span>
<span>  validation <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  lambda <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  optimizer <span class="op">=</span> <span class="st">"adam"</span>,</span>
<span>  lr <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  epochs <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  device <span class="op">=</span> <span class="st">"cpu"</span>,</span>
<span>  ncores <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  early_stopping <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-graph">graph<a class="anchor" aria-label="anchor" href="#arg-graph"></a></dt>
<dd><p>An igraph object.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A matrix with rows corresponding to subjects, and columns
to graph nodes (variables).</p></dd>


<dt id="arg-outcome">outcome<a class="anchor" aria-label="anchor" href="#arg-outcome"></a></dt>
<dd><p>A character vector (as.factor) of labels for a categorical
output (target). If NULL (default), the categorical output (target) will
not be considered.</p></dd>


<dt id="arg-thr">thr<a class="anchor" aria-label="anchor" href="#arg-thr"></a></dt>
<dd><p>A numeric value [0-1] indicating the threshold to apply to the
Olden's connection weights to color the graph. If thr = NULL (default), the
threshold is set to thr = 0.5*max(abs(connection weights)).</p></dd>


<dt id="arg-nboot">nboot<a class="anchor" aria-label="anchor" href="#arg-nboot"></a></dt>
<dd><p>number of bootstrap samples that will be used to compute cheap
(lower, upper) CIs for all input variable weights. As a default, nboot = 0.</p></dd>


<dt id="arg-hidden">hidden<a class="anchor" aria-label="anchor" href="#arg-hidden"></a></dt>
<dd><p>hidden units in layers; the number of layers corresponds with
the length of the hidden units. As a default, hidden = c(10L, 10L, 10L).</p></dd>


<dt id="arg-link">link<a class="anchor" aria-label="anchor" href="#arg-link"></a></dt>
<dd><p>A character value describing the activation function to use, which
might be a single length or be a vector with many activation functions assigned
to each layer. As a default, link = "selu".</p></dd>


<dt id="arg-bias">bias<a class="anchor" aria-label="anchor" href="#arg-bias"></a></dt>
<dd><p>A logical vector, indicating whether to employ biases in the layers,
which can be either vectors of logicals for each layer (number of hidden layers
+ 1 (final layer)) or of length one.  As a default, bias = TRUE.</p></dd>


<dt id="arg-dropout">dropout<a class="anchor" aria-label="anchor" href="#arg-dropout"></a></dt>
<dd><p>A numerical value for the dropout rate, which is the probability
that a node will be excluded from training.  As a default, dropout = 0.</p></dd>


<dt id="arg-loss">loss<a class="anchor" aria-label="anchor" href="#arg-loss"></a></dt>
<dd><p>A character value specifying the at which the network should
be optimized. For regression problem used in SEMdnn(), the user can specify:
(a) "mse" (mean squared error), "mae" (mean absolute error), or "gaussian"
(normal likelihood). As a default, loss = "mse".</p></dd>


<dt id="arg-validation">validation<a class="anchor" aria-label="anchor" href="#arg-validation"></a></dt>
<dd><p>A numerical value indicating the proportion of the data set
that should be used as a validation set (randomly selected, default = 0).</p></dd>


<dt id="arg-lambda">lambda<a class="anchor" aria-label="anchor" href="#arg-lambda"></a></dt>
<dd><p>A numerical value indicating the strength of the regularization,
\(\lambda\)(L1 + L2) for lambda penalty (default = 0).</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>A numerical vector to add L1/L2 regularization into the training.
Set the alpha parameter for each layer to (1-\(\alpha\))L1 + \(\alpha\)L2.
It must fall between 0 and 1 (default = 0.5).</p></dd>


<dt id="arg-optimizer">optimizer<a class="anchor" aria-label="anchor" href="#arg-optimizer"></a></dt>
<dd><p>A character value indicating the optimizer to use for
training the network. The user can specify: "adam" (ADAM algorithm), "adagrad"
(adaptive gradient algorithm), "rmsprop" (root mean squared propagation),
"rprop” (resilient backpropagation), "sgd" (stochastic gradient descent).
As a default, optimizer = "adam".</p></dd>


<dt id="arg-lr">lr<a class="anchor" aria-label="anchor" href="#arg-lr"></a></dt>
<dd><p>A numerical value indicating the learning rate given to the optimizer
(default = 0.01).</p></dd>


<dt id="arg-epochs">epochs<a class="anchor" aria-label="anchor" href="#arg-epochs"></a></dt>
<dd><p>A numerical value indicating the epochs during which the training
is conducted (default = 100).</p></dd>


<dt id="arg-device">device<a class="anchor" aria-label="anchor" href="#arg-device"></a></dt>
<dd><p>A character value describing the CPU/GPU device ("cpu", "cuda", "mps")
on which the  neural network should be trained on. As a default, device = "cpu".</p></dd>


<dt id="arg-ncores">ncores<a class="anchor" aria-label="anchor" href="#arg-ncores"></a></dt>
<dd><p>number of cpu cores (default = 2)</p></dd>


<dt id="arg-early-stopping">early_stopping<a class="anchor" aria-label="anchor" href="#arg-early-stopping"></a></dt>
<dd><p>If set to integer, training will terminate if the loss
increases over a predetermined number of consecutive epochs and apply validation
loss when available. Default is FALSE, no early stopping is applied.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>The training loss values of the DNN model are displayed as output,
comparing the training, validation and baseline in the last epoch (default = FALSE).</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Currently ignored.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>An S3 object of class "DNN" is returned. It is a list of 5 objects:</p><ol><li><p>"fit", a list of DNN model objects, including: the estimated covariance
matrix (Sigma), the estimated model errors (Psi), the fitting indices (fitIdx),
and the parameterEstimates, i.e., the data.frame of Olden's connection weights.</p></li>
<li><p>"gest", the data.frame of estimated connection weights (parameterEstimates)
of outcome levels, if outcome != NULL.</p></li>
<li><p>"model", a list of all j=1,...,(L-1) fitted MLP network models.</p></li>
<li><p>"graph", the induced DAG of the input graph mapped on data variables.
The DAG is colored based on the Olden's connection weights (W), if abs(W) &gt; thr
and W &lt; 0, the edge is inhibited and it is highlighted in blue; otherwise, if
abs(W) &gt; thr and W &gt; 0, the edge is activated and it is highlighted in red.
If the outcome vector is given, nodes with absolute connection weights summed
over the outcome levels, i.e. sum(abs(W[outcome levels])) &gt; thr, will be
highlighted in pink.</p></li>
<li><p>"data", input data subset mapping graph nodes.</p></li>
</ol></div>
    <div id="details">
    <h2>Details</h2>
    <p>By mapping data onto the input graph, <code>SEMdnn()</code> creates a set
of DNN models based on the topological layer (j=1,…,L) structure of the input
graph. In each iteration, the response (output) variables, y are the nodes in
the j=1,...,(L-1) layer and the predictor (input) variables, x are the nodes
belonging to the successive, (j+1),...,L layers.
Each DNN model is a Multilayer Perceptron (MLP) network, where every neuron node
is connected to every other neuron node in the hidden layer above and every other
hidden layer below. Each neuron's value is determined by calculating a weighted
summation of its outputs from the hidden layer before it, and then applying an
activation function.  The calculated value of every neuron is used as the input
for the neurons in the layer below it, until the output layer is reached.</p>
<p>If boot != 0, the function will implement the cheap bootstrapping proposed by
Lam (2002) to generate uncertainties, i.e. 90<!-- % confidence intervals (90% CIs), -->
for DNN parameters. Bootstrapping can be enabled by setting a small number
(1 to 10) of bootstrap samples. Note, however, that the computation can be
time-consuming for massive DNNs, even with cheap bootstrapping!</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Amesöder, C., Hartig, F. and Pichler, M. (2024), ‘cito': an R package for training
neural networks using ‘torch'. Ecography, 2024: e07143. https://doi.org/10.1111/ecog.07143</p>
<p>Grassi M, Palluzzi F, Tarantino B (2022). SEMgraph: An R Package for Causal Network
Analysis of High-Throughput Data with Structural Equation Models.
Bioinformatics, 38 (20), 4829–4830. &lt;https://doi.org/10.1093/bioinformatics/btac567&gt;</p>
<p>Lam, H. (2022). Cheap bootstrap for input uncertainty quantification. WSC '22:
Proceedings of the Winter Simulation Conference, 2318 - 2329.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Mario Grassi <a href="mailto:mario.grassi@unipv.it">mario.grassi@unipv.it</a></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_is_installed.html" class="external-link">torch_is_installed</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load ALS data</span></span></span>
<span class="r-in"><span><span class="va">ig</span><span class="op">&lt;-</span> <span class="va">alsData</span><span class="op">$</span><span class="va">graph</span></span></span>
<span class="r-in"><span><span class="va">data</span><span class="op">&lt;-</span> <span class="va">alsData</span><span class="op">$</span><span class="va">exprs</span></span></span>
<span class="r-in"><span><span class="va">data</span><span class="op">&lt;-</span> <span class="fu">transformData</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">$</span><span class="va">data</span></span></span>
<span class="r-in"><span><span class="va">group</span><span class="op">&lt;-</span> <span class="va">alsData</span><span class="op">$</span><span class="va">group</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#...with train-test (0.5-0.5) samples</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">train</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#ncores&lt;- parallel::detectCores(logical = FALSE)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">start</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dnn0</span><span class="op">&lt;-</span> <span class="fu">SEMdnn</span><span class="op">(</span><span class="va">ig</span>, <span class="va">data</span><span class="op">[</span><span class="va">train</span>, <span class="op">]</span>, thr <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>      <span class="co">#hidden = 5*K, link = "selu", bias = TRUE,</span></span></span>
<span class="r-in"><span>      hidden <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">10</span><span class="op">)</span>, link <span class="op">=</span> <span class="st">"selu"</span>, bias <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>      validation <span class="op">=</span> <span class="fl">0</span>, epochs <span class="op">=</span> <span class="fl">32</span>, ncores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">end</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">end</span><span class="op">-</span><span class="va">start</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#str(dnn0, max.level=2)</span></span></span>
<span class="r-in"><span><span class="va">dnn0</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">fitIdx</span></span></span>
<span class="r-in"><span><span class="fu">parameterEstimates</span><span class="op">(</span><span class="va">dnn0</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">gplot</span><span class="op">(</span><span class="va">dnn0</span><span class="op">$</span><span class="va">graph</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu">E</span><span class="op">(</span><span class="va">dnn0</span><span class="op">$</span><span class="va">graph</span><span class="op">)</span><span class="op">$</span><span class="va">color</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#...with source nodes -&gt; graph layer structure -&gt; sink nodes</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Topological layer (TL) ordering</span></span></span>
<span class="r-in"><span><span class="va">K</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>,  <span class="fl">5</span>,  <span class="fl">3</span>,  <span class="fl">2</span>,  <span class="fl">1</span>,  <span class="fl">8</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">K</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">K</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>;<span class="va">K</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ig1</span><span class="op">&lt;-</span> <span class="fu"><a href="mapGraph.html">mapGraph</a></span><span class="op">(</span><span class="va">ig</span>, type<span class="op">=</span><span class="st">"source"</span><span class="op">)</span>; <span class="fu">gplot</span><span class="op">(</span><span class="va">ig1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">start</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dnn1</span><span class="op">&lt;-</span> <span class="fu">SEMdnn</span><span class="op">(</span><span class="va">ig1</span>, <span class="va">data</span><span class="op">[</span><span class="va">train</span>, <span class="op">]</span>, thr <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>      hidden <span class="op">=</span> <span class="fl">5</span><span class="op">*</span><span class="va">K</span>, link <span class="op">=</span> <span class="st">"selu"</span>, bias <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    validation <span class="op">=</span> <span class="fl">0</span>, epochs <span class="op">=</span> <span class="fl">32</span>, ncores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">end</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">end</span><span class="op">-</span><span class="va">start</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Visualization of the neural network structure</span></span></span>
<span class="r-in"><span><span class="va">nn1</span> <span class="op">&lt;-</span> <span class="va">dnn1</span><span class="op">$</span><span class="va">model</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="nplot.html">nplot</a></span><span class="op">(</span><span class="va">nn1</span>, bias<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#str(dnn1, max.level=2)</span></span></span>
<span class="r-in"><span><span class="va">dnn1</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">fitIdx</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dnn1</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">Psi</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">parameterEstimates</span><span class="op">(</span><span class="va">dnn1</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">gplot</span><span class="op">(</span><span class="va">dnn1</span><span class="op">$</span><span class="va">graph</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu">E</span><span class="op">(</span><span class="va">dnn1</span><span class="op">$</span><span class="va">graph</span><span class="op">)</span><span class="op">$</span><span class="va">color</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#...with a categorical outcome, a train set (0.5) and a validation set (0.2)</span></span></span>
<span class="r-in"><span><span class="va">outcome</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="fl">0</span>, <span class="st">"control"</span>, <span class="st">"case"</span><span class="op">)</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> </span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">start</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dnn2</span><span class="op">&lt;-</span> <span class="fu">SEMdnn</span><span class="op">(</span><span class="va">ig</span>, <span class="va">data</span><span class="op">[</span><span class="va">train</span>, <span class="op">]</span>, <span class="va">outcome</span><span class="op">[</span><span class="va">train</span><span class="op">]</span>, thr <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>      <span class="co">#hidden = 5*K, link = "selu", bias = TRUE,</span></span></span>
<span class="r-in"><span>      hidden <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">10</span><span class="op">)</span>, link <span class="op">=</span> <span class="st">"selu"</span>, bias <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>      validation <span class="op">=</span> <span class="fl">0.2</span>, epochs <span class="op">=</span> <span class="fl">32</span>, ncores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">end</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">end</span><span class="op">-</span><span class="va">start</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#str(dnn2, max.level=2)</span></span></span>
<span class="r-in"><span><span class="va">dnn2</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">fitIdx</span></span></span>
<span class="r-in"><span><span class="fu">parameterEstimates</span><span class="op">(</span><span class="va">dnn2</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">gplot</span><span class="op">(</span><span class="va">dnn2</span><span class="op">$</span><span class="va">graph</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu">E</span><span class="op">(</span><span class="va">dnn2</span><span class="op">$</span><span class="va">graph</span><span class="op">)</span><span class="op">$</span><span class="va">color</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu">V</span><span class="op">(</span><span class="va">dnn2</span><span class="op">$</span><span class="va">graph</span><span class="op">)</span><span class="op">$</span><span class="va">color</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conducting the nonparanormal transformation via shrunkun ECDF...done.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running SEM model via DNN...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  done.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> DNN solver ended normally after 736 iterations</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  logL:-41.518629  srmr:0.1845</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time difference of 4.837363 secs</span>
<span class="r-plt img"><img src="SEMdnn-1.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="SEMdnn-2.png" alt="" width="700" height="433"></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running SEM model via DNN...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  done.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> DNN solver ended normally after 384 iterations</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  logL:-20.679355  srmr:0.154085</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time difference of 2.863694 secs</span>
<span class="r-plt img"><img src="SEMdnn-3.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="SEMdnn-4.png" alt="" width="700" height="433"></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running SEM model via DNN...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  done.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> DNN solver ended normally after 800 iterations</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  logL:-43.263141  srmr:0.179866</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time difference of 4.60148 secs</span>
<span class="r-plt img"><img src="SEMdnn-5.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  pink white </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     8    23 </span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Mario Grassi, Barbara Tarantino.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>


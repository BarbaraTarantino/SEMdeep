<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Layer-wise SEM train with a Deep Neural Netwok (DNN) — SEMdnn • SEMdeep</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Layer-wise SEM train with a Deep Neural Netwok (DNN) — SEMdnn"><meta property="og:description" content="The function builds the topological layer (TL) ordering
of the input graph to fit a series of Deep Neural Networks (DNN) 
models, where the nodes in one layer act as response variables (output) 
y and the nodes in the sucessive layers act as predictors (input) x. 
Each fit uses the dnn function of the cito R
package, based on the deep learning framework 'torch'. The torch
package is native to R, so it's computationally efficient and the
installation is very simple, as there is no need to install Python
or any other API."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SEMdeep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/BarbaraTarantino/SEMdeep/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Layer-wise SEM train with a Deep Neural Netwok (DNN)</h1>
    <small class="dont-index">Source: <a href="https://github.com/BarbaraTarantino/SEMdeep/blob/HEAD/R/SEMdnn.R" class="external-link"><code>R/SEMdnn.R</code></a></small>
    <div class="hidden name"><code>SEMdnn.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The function builds the topological layer (TL) ordering
of the input graph to fit a series of Deep Neural Networks (DNN) 
models, where the nodes in one layer act as response variables (output) 
y and the nodes in the sucessive layers act as predictors (input) x. 
Each fit uses the <code><a href="https://citoverse.github.io/cito/reference/dnn.html" class="external-link">dnn</a></code> function of the <span class="pkg">cito</span> R
package, based on the deep learning framework 'torch'. The <span class="pkg">torch</span>
package is native to R, so it's computationally efficient and the
installation is very simple, as there is no need to install Python
or any other API.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">SEMdnn</span><span class="op">(</span></span>
<span>  <span class="va">graph</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  train <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cowt <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  thr <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  loss <span class="op">=</span> <span class="st">"mse"</span>,</span>
<span>  hidden <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10L</span>, <span class="fl">10L</span>, <span class="fl">10L</span><span class="op">)</span>,</span>
<span>  link <span class="op">=</span> <span class="st">"relu"</span>,</span>
<span>  validation <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  bias <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  lambda <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  dropout <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  optimizer <span class="op">=</span> <span class="st">"adam"</span>,</span>
<span>  lr <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  epochs <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  device <span class="op">=</span> <span class="st">"cpu"</span>,</span>
<span>  early_stopping <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>graph</dt>
<dd><p>An igraph object.</p></dd>


<dt>data</dt>
<dd><p>A matrix with rows corresponding to subjects, and columns
to graph nodes (variables).</p></dd>


<dt>train</dt>
<dd><p>A numeric vector specifying the row indices corresponding to 
the train dataset.</p></dd>


<dt>cowt</dt>
<dd><p>A logical value. If <code>cowt=TRUE</code> connection weights of the
input node (variables) are computing (default = FALSE).</p></dd>


<dt>thr</dt>
<dd><p>A numerical value indicating the threshold to apply on the absolute
values of the connection matrix to color the graph (default = NULL).</p></dd>


<dt>loss</dt>
<dd><p>A character value specifying the loss after which network should 
be optimized. The user can specify: (a) "mse" (mean squared error), "mae" 
(mean absolute error), or "gaussian" (normal likelihood), for regression problems; 
(b) "poisson" (poisson likelihood), or "nbinom" (negative binomial likelihood)
for regression with count data; (c) "binomial" (binomial likelihood) for 
binary classification problems; (d) "softmax" or "cross-entropy" for multi-class
classification (default = "mse").</p></dd>


<dt>hidden</dt>
<dd><p>hidden units in layers; the number of layers corresponds with
the length of the hidden units. As a default, <code>hidden = c(10L, 10L, 10L)</code>.</p></dd>


<dt>link</dt>
<dd><p>A character value describing the activation function to use, which 
might be a single length or be a vector with many activation functions assigned
to each layer (default = "relu").</p></dd>


<dt>validation</dt>
<dd><p>A numerical value indicating the proportion of the data set 
that should be used as a validation set (randomly selected, default = 0).</p></dd>


<dt>bias</dt>
<dd><p>A logical vector, indicating whether to employ biases in the layers 
(<code>bias = TRUE</code>), which can be either vectors of logicals for each layer 
(number of hidden layers + 1 (final layer)) or of length one (default = TRUE).</p></dd>


<dt>lambda</dt>
<dd><p>A numerical value indicating the strength of regularization: 
lambda penalty, \(\lambda * (L1 + L2)\) (default = 0).</p></dd>


<dt>alpha</dt>
<dd><p>A numerical vector to add L1/L2 regularization into the training. 
Set the alpha parameter for each layer to \((1 - \alpha) * ||weights||_1 + 
\alpha ||weights||^2\). It must fall between 0 and 1 (default = 0.5).</p></dd>


<dt>dropout</dt>
<dd><p>A numerical value for the dropout rate, which is the probability
that a node will be excluded from training (default = 0).</p></dd>


<dt>optimizer</dt>
<dd><p>A character value indicating the optimizer to use for 
training the network. The user can specify: "adam" (ADAM algorithm), "adagrad"
(adaptive gradient algorithm), "rmsprop" (root mean squared propagation),
"rprop” (resilient backpropagation), "sgd" (stochastic gradient descent).
As a default, <code>optimizer = “adam”</code>.</p></dd>


<dt>lr</dt>
<dd><p>A numerical value indicating the learning rate given to the optimizer 
(default = 0.01).</p></dd>


<dt>epochs</dt>
<dd><p>A numerical value indicating the epochs during which the training 
is conducted (default = 100).</p></dd>


<dt>device</dt>
<dd><p>A character value describing the CPU/GPU device ("cpu", "cuda", "mps")
on which the  neural network should be trained on (default = "cpu")</p></dd>


<dt>early_stopping</dt>
<dd><p>If set to integer, training will terminate if the loss 
increases over a predetermined number of consecutive epochs and apply validation
loss when available. Default is FALSE, no early stopping is applied.</p></dd>


<dt>verbose</dt>
<dd><p>If <code>verbose = TRUE</code>, the training curves of the DNN models
are displayed as output, comparing the training, validation and baseline 
curves in terms of loss (y) against the number of epochs (x) (default = TRUE).</p></dd>


<dt>...</dt>
<dd><p>Currently ignored.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An S3 object of class "DNN" is returned. It is a list of 5 objects:</p><ol><li><p>"fit", a list of DNN model objects, including: the estimated covariance 
matrix (Sigma), the estimated model errors (Psi), the fitting indices (fitIdx),
and the estimated connection weights (parameterEstimates), if cowt=TRUE.</p></li>
<li><p>“Yhat”, a matrix of prediction values of sink and mediator graph nodes.</p></li>
<li><p>"model", a list of all j=1,...,(L-1) fitted MLP network models.</p></li>
<li><p>"graph", the induced DAG of the input graph mapped on data variables.
If cowt=TRUE, the DAG is colored based on the estimated connection weights, if
abs(W) &gt; thr and W &lt; 0,  the edge is inhibited and it is highlighted in blue;
otherwise, if abs(W) &gt; thr and W &gt; 0, the edge is activated and it is highlighted
in red.</p></li>
<li><p>"data", input training data subset mapping graph nodes.</p></li>
</ol></div>
    <div id="details">
    <h2>Details</h2>
    <p>By mapping data onto the input graph, <code>SEMdnn()</code> creates a set 
of DNN models based on the topological layer (j=1,…,L) structure of the input
graph. In each iteration, the response (output) variables, y are the nodes in
the j=1,...,(L-1) layer and the predictor (input) variables, x are the nodes
belonging to the successive, (j+1),...,L layers. 
Each DNN model is a Multilayer Perceptron (MLP) network, where every neuron node
is connected to every other neuron node in the hidden layer above and every other
hidden layer below. Each neuron's value is determined by calculating a weighted
summation of its outputs from the hidden layer before it, and then applying an
activation function.  The calculated value of every neuron is used as the input
for the neurons in the layer below it, until the output layer is reached.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Amesöder, C., Hartig, F. and Pichler, M. (2024), ‘cito': an R package for training
neural networks using ‘torch'. Ecography, 2024: e07143. https://doi.org/10.1111/ecog.07143</p>
<p>Grassi M, Palluzzi F, Tarantino B (2022). SEMgraph: An R Package for Causal Network
Analysis of High-Throughput Data with Structural Equation Models.
Bioinformatics, 38 (20), 4829–4830 &lt;https://doi.org/10.1093/bioinformatics/btac567&gt;</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Mario Grassi <a href="mailto:mario.grassi@unipv.it">mario.grassi@unipv.it</a></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Before running the first time the torch backend needs to be installed</span></span></span>
<span class="r-in"><span><span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/install_torch.html" class="external-link">install_torch</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Check whether a compatible GPU is available for computation.</span></span></span>
<span class="r-in"><span><span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/cuda_is_available.html" class="external-link">cuda_is_available</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-in"><span><span class="co">#In Windows, if C Visul Studio in not installed:</span></span></span>
<span class="r-in"><span><span class="co">#download and install VC_redist.x64.exe file </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># load ALS data</span></span></span>
<span class="r-in"><span><span class="va">ig</span><span class="op">&lt;-</span> <span class="va">alsData</span><span class="op">$</span><span class="va">graph</span></span></span>
<span class="r-in"><span><span class="va">data</span><span class="op">&lt;-</span> <span class="va">alsData</span><span class="op">$</span><span class="va">exprs</span></span></span>
<span class="r-in"><span><span class="va">data</span><span class="op">&lt;-</span> <span class="fu">transformData</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">$</span><span class="va">data</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conducting the nonparanormal transformation via shrunkun ECDF...done.</span>
<span class="r-in"><span><span class="va">group</span><span class="op">&lt;-</span> <span class="va">alsData</span><span class="op">$</span><span class="va">group</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#...with train-test (0.5-0.5) samples</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">train</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#thr&lt;- 1/sqrt(2*nrow(data[train, ])) #Joseph(2020, formula 22)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">start</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dnn0</span> <span class="op">&lt;-</span> <span class="fu">SEMdnn</span><span class="op">(</span><span class="va">ig</span>, <span class="va">data</span>, <span class="va">train</span>, cowt <span class="op">=</span> <span class="cn">TRUE</span>, thr <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>      <span class="co">#loss = "mse", hidden = 5*K, link = "selu",</span></span></span>
<span class="r-in"><span>      loss <span class="op">=</span> <span class="st">"mse"</span>, hidden <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>, link <span class="op">=</span> <span class="st">"selu"</span>,</span></span>
<span class="r-in"><span>      validation <span class="op">=</span> <span class="fl">0</span>, bias <span class="op">=</span> <span class="cn">TRUE</span>, lr <span class="op">=</span> <span class="fl">0.01</span>,</span></span>
<span class="r-in"><span>      epochs <span class="op">=</span> <span class="fl">32</span>, device <span class="op">=</span> <span class="st">"cpu"</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 : z10452 z84134 z836 z4747 z4741 z4744 z79139 z5530 z5532 z5533 z5534 z5535 </span>
<span class="r-plt img"><img src="SEMdnn-1.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    epoch   train_l valid_l</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32    32 0.2159711      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 : z842 z1432 z5600 z5603 z6300 </span>
<span class="r-plt img"><img src="SEMdnn-2.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    epoch   train_l valid_l</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32    32 0.2481931      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 : z54205 z5606 z5608 </span>
<span class="r-plt img"><img src="SEMdnn-3.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    epoch   train_l valid_l</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32    32 0.2765097      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 : z596 z4217 </span>
<span class="r-plt img"><img src="SEMdnn-4.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    epoch   train_l valid_l</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32    32 0.2362523      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 : z1616 </span>
<span class="r-plt img"><img src="SEMdnn-5.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    epoch   train_l valid_l</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32    32 0.3188612      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DNN solver ended normally after 736 iterations </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  logL: -32.30098  srmr: 0.0981405 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">end</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">end</span><span class="op">-</span><span class="va">start</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time difference of 11.6742 secs</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#str(dnn0, max.level=2)</span></span></span>
<span class="r-in"><span><span class="va">dnn0</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">fitIdx</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         logL         amse         rmse         srmr </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -32.30098470   0.21774742   0.46663414   0.09814047 </span>
<span class="r-in"><span><span class="va">dnn0</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">parameterEstimates</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $beta</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      lhs op   rhs weight</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  10452  ~  6647 -0.070</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  84134  ~  6647 -0.020</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3    836  ~   842 -0.057</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   4747  ~  1432  0.226</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   4747  ~  5600  0.056</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6   4747  ~  5603  0.106</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7   4747  ~  6300  0.112</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8   4747  ~  6647  0.122</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9   4747  ~  5630  0.016</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10  4741  ~  1432  0.126</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11  4741  ~  5600 -0.362</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12  4741  ~  5603 -0.127</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13  4741  ~  6300  0.124</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14  4741  ~  5630 -0.135</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15  4744  ~  1432  0.114</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16  4744  ~  5600 -0.453</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17  4744  ~  5603 -0.210</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18  4744  ~  6300  0.115</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19  4744  ~  5630 -0.146</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20 79139  ~  6647  0.393</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21  5530  ~  6647  0.124</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22  5532  ~  6647  0.167</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23  5533  ~  6647 -0.199</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24  5534  ~  6647  0.066</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25  5535  ~  6647 -0.437</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26   842  ~ 54205 -0.298</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27   842  ~   317 -0.065</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28  1432  ~  5606  0.670</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29  1432  ~  5608  0.109</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30  5600  ~  5606  0.270</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31  5600  ~  5608 -0.223</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32  5603  ~  5606  0.624</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33  5603  ~  5608  0.007</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 34  6300  ~  5606 -0.067</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 35  6300  ~  5608 -0.261</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36 54205  ~   596 -0.032</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 37 54205  ~   581 -0.290</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 38 54205  ~   572 -0.046</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 39 54205  ~   598 -0.088</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 40  5606  ~  4217  0.184</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 41  5608  ~  4217  0.279</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 42   596  ~  6647 -0.092</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 43  4217  ~  1616  0.087</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44  1616  ~  7132 -0.023</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 45  1616  ~  7133 -0.090</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $psi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      10452      84134        836       4747       4741       4744      79139 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.15707515 0.18742523 0.17466681 0.17385580 0.24609397 0.34131618 0.18930528 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       5530       5532       5533       5534       5535        842       1432 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.14870483 0.13199068 0.34058738 0.09468743 0.24125727 0.32895261 0.19927993 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       5600       5603       6300      54205       5606       5608        596 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.17209406 0.29493356 0.14704744 0.25465521 0.24759856 0.22324071 0.24664578 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       4217       1616 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.18679063 0.27998616 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu">gplot</span><span class="op">(</span><span class="va">dnn0</span><span class="op">$</span><span class="va">graph</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="SEMdnn-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu">E</span><span class="op">(</span><span class="va">dnn0</span><span class="op">$</span><span class="va">graph</span><span class="op">)</span><span class="op">$</span><span class="va">color</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     gray50       red2 royalblue3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         29          7          9 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#...with a binary outcome (1=case, 0=control)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ig1</span><span class="op">&lt;-</span> <span class="fu"><a href="mapGraph.html">mapGraph</a></span><span class="op">(</span><span class="va">ig</span>, type<span class="op">=</span><span class="st">"outcome"</span><span class="op">)</span>; <span class="fu">gplot</span><span class="op">(</span><span class="va">ig1</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="SEMdnn-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">outcome</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> outcome</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  -1   1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  21 139 </span>
<span class="r-in"><span><span class="va">data1</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="va">data</span><span class="op">)</span>; <span class="va">data1</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      outcome        207         208      10000       284</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ALS2       1 -1.8273895 -0.45307006 -0.1360061 0.4530701</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ALS3       1 -2.5616910 -0.96201413  0.3160400 0.6762093</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ALS4       1 -0.8003346  0.82216031 -1.1521227 0.5613048</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ALS5       1 -2.1342965 -0.98709115  1.1521227 0.5064807</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ALS6       1 -2.0111279  0.02393297  0.5987578 0.1360061</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">start</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dnn1</span> <span class="op">&lt;-</span> <span class="fu">SEMdnn</span><span class="op">(</span><span class="va">ig1</span>, <span class="va">data1</span>, <span class="va">train</span>, cowt <span class="op">=</span> <span class="cn">TRUE</span>, thr <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>      <span class="co">#loss = "mse", hidden = 5*K, link = "selu",</span></span></span>
<span class="r-in"><span>      loss <span class="op">=</span> <span class="st">"mse"</span>, hidden <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>, link <span class="op">=</span> <span class="st">"selu"</span>,</span></span>
<span class="r-in"><span>      validation <span class="op">=</span> <span class="fl">0</span>, bias <span class="op">=</span> <span class="cn">TRUE</span>, lr <span class="op">=</span> <span class="fl">0.01</span>,</span></span>
<span class="r-in"><span>      epochs <span class="op">=</span> <span class="fl">32</span>, device <span class="op">=</span> <span class="st">"cpu"</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 : zoutcome </span>
<span class="r-plt img"><img src="SEMdnn-8.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    epoch     train_l valid_l</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32    32 0.002546805      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 : z10452 z84134 z836 z4747 z4741 z4744 z79139 z5530 z5532 z5533 z5534 z5535 </span>
<span class="r-plt img"><img src="SEMdnn-9.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    epoch   train_l valid_l</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32    32 0.2201546      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 : z842 z1432 z5600 z5603 z6300 </span>
<span class="r-plt img"><img src="SEMdnn-10.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    epoch   train_l valid_l</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32    32 0.2845954      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 : z54205 z5606 z5608 </span>
<span class="r-plt img"><img src="SEMdnn-11.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    epoch   train_l valid_l</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32    32 0.2446923      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 : z596 z4217 </span>
<span class="r-plt img"><img src="SEMdnn-12.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    epoch   train_l valid_l</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32    32 0.2627825      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 : z1616 </span>
<span class="r-plt img"><img src="SEMdnn-13.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    epoch   train_l valid_l</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32    32 0.2539346      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DNN solver ended normally after 768 iterations </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  logL: -31.43678  srmr: 0.0817667 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">end</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">end</span><span class="op">-</span><span class="va">start</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time difference of 14.34253 secs</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#str(dnn1, max.level=2)</span></span></span>
<span class="r-in"><span><span class="va">dnn1</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">fitIdx</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         logL         amse         rmse         srmr </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -31.43678085   0.21080077   0.45913045   0.08176674 </span>
<span class="r-in"><span><span class="va">dnn1</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">parameterEstimates</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $beta</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        lhs op   rhs weight</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  outcome  ~ 10452  0.092</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  outcome  ~ 84134 -0.126</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  outcome  ~   836  0.026</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  outcome  ~  4747 -0.388</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  outcome  ~  4741  0.688</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  outcome  ~  4744 -0.238</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  outcome  ~ 79139 -0.352</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  outcome  ~  5530 -0.300</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  outcome  ~  5532  0.185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 outcome  ~  5533 -0.433</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 outcome  ~  5534  1.056</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12 outcome  ~  5535 -0.168</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13   10452  ~  6647  0.056</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14   84134  ~  6647  0.008</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15     836  ~   842 -0.073</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16    4747  ~  1432  0.216</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17    4747  ~  5600 -0.210</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18    4747  ~  5603  0.192</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19    4747  ~  6300 -0.099</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20    4747  ~  6647  0.212</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21    4747  ~  5630 -0.074</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22    4741  ~  1432  0.144</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23    4741  ~  5600 -0.483</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24    4741  ~  5603  0.109</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25    4741  ~  6300 -0.104</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26    4741  ~  5630 -0.115</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27    4744  ~  1432  0.167</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28    4744  ~  5600 -0.577</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29    4744  ~  5603  0.030</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30    4744  ~  6300 -0.082</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31    4744  ~  5630 -0.089</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32   79139  ~  6647  0.210</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33    5530  ~  6647  0.006</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 34    5532  ~  6647  0.058</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 35    5533  ~  6647 -0.194</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36    5534  ~  6647  0.093</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 37    5535  ~  6647 -0.431</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 38     842  ~ 54205 -0.212</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 39     842  ~   317 -0.005</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 40    1432  ~  5606  0.539</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 41    1432  ~  5608 -0.065</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 42    5600  ~  5606  0.111</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 43    5600  ~  5608 -0.283</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44    5603  ~  5606  0.318</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 45    5603  ~  5608 -0.084</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 46    6300  ~  5606 -0.037</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 47    6300  ~  5608 -0.226</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 48   54205  ~   596  0.015</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 49   54205  ~   581 -0.201</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 50   54205  ~   572  0.019</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 51   54205  ~   598 -0.119</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 52    5606  ~  4217 -0.068</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 53    5608  ~  4217  0.257</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 54     596  ~  6647  0.107</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 55    4217  ~  1616  0.037</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 56    1616  ~  7132  0.046</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 57    1616  ~  7133 -0.109</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $psi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     outcome       10452       84134         836        4747        4741 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.002034552 0.189041299 0.179502891 0.185158318 0.135884377 0.265985356 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        4744       79139        5530        5532        5533        5534 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.265396177 0.237179492 0.113815943 0.117037126 0.378614282 0.108513178 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        5535         842        1432        5600        5603        6300 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.285010313 0.290987988 0.228473823 0.166808798 0.344245283 0.167602721 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       54205        5606        5608         596        4217        1616 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.249776846 0.233745573 0.200035960 0.298180172 0.177157783 0.239030337 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu">gplot</span><span class="op">(</span><span class="va">dnn1</span><span class="op">$</span><span class="va">graph</span><span class="op">)</span> </span></span>
<span class="r-plt img"><img src="SEMdnn-14.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu">E</span><span class="op">(</span><span class="va">dnn1</span><span class="op">$</span><span class="va">graph</span><span class="op">)</span><span class="op">$</span><span class="va">color</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     gray50       red2 royalblue3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         35          8         14 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#...with input -&gt; hidden structure -&gt; output :</span></span></span>
<span class="r-in"><span><span class="co"># source nodes -&gt; graph layer structure -&gt; sink nodes</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#View topological layer (TL) ordering</span></span></span>
<span class="r-in"><span><span class="va">dag</span><span class="op">&lt;-</span> <span class="fu">graph2dag</span><span class="op">(</span><span class="va">dnn0</span><span class="op">$</span><span class="va">graph</span>, <span class="va">data</span><span class="op">[</span><span class="va">train</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">L</span><span class="op">&lt;-</span> <span class="fu">SEMdeep</span><span class="fu">:::</span><span class="fu">buildLevels</span><span class="op">(</span><span class="va">dag</span><span class="op">)</span>;<span class="va">L</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "10452" "84134" "836"   "4747"  "4741"  "4744"  "79139" "5530"  "5532" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10] "5533"  "5534"  "5535" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "842"  "1432" "5600" "5603" "6300"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[3]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "54205" "5606"  "5608" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[4]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "596"  "4217"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[5]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "1616"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[6]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "6647" "5630" "317"  "581"  "572"  "598"  "7132" "7133"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">K</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">L</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span>;<span class="va">K</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 12  5  3  2  1  8</span>
<span class="r-in"><span><span class="va">K</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">K</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>;<span class="va">K</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 2 3 5</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ig2</span><span class="op">&lt;-</span> <span class="fu"><a href="mapGraph.html">mapGraph</a></span><span class="op">(</span><span class="va">ig</span>, type<span class="op">=</span><span class="st">"source"</span><span class="op">)</span>; <span class="fu">gplot</span><span class="op">(</span><span class="va">ig2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="SEMdnn-15.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">start</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dnn2</span> <span class="op">&lt;-</span> <span class="fu">SEMdnn</span><span class="op">(</span><span class="va">ig2</span>, <span class="va">data</span>, <span class="va">train</span>, cowt <span class="op">=</span> <span class="cn">TRUE</span>, thr <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>      loss <span class="op">=</span> <span class="st">"mse"</span>, hidden <span class="op">=</span> <span class="fl">5</span><span class="op">*</span><span class="va">K</span>, link <span class="op">=</span> <span class="st">"selu"</span>,</span></span>
<span class="r-in"><span>      <span class="co">#loss = "mse", hidden = c(10, 10, 10), link = "selu",</span></span></span>
<span class="r-in"><span>      validation <span class="op">=</span> <span class="fl">0</span>, bias <span class="op">=</span> <span class="cn">TRUE</span>, lr <span class="op">=</span> <span class="fl">0.01</span>,</span></span>
<span class="r-in"><span>      epochs <span class="op">=</span> <span class="fl">32</span>, device <span class="op">=</span> <span class="st">"cpu"</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 : z10452 z84134 z836 z4747 z4741 z4744 z79139 z5530 z5532 z5533 z5534 z5535 </span>
<span class="r-plt img"><img src="SEMdnn-16.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    epoch   train_l valid_l</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32    32 0.4356513      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DNN solver ended normally after 384 iterations </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  logL: -20.78945  srmr: 0.1721242 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">end</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">end</span><span class="op">-</span><span class="va">start</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time difference of 2.992394 secs</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Visualization of the neural network structure</span></span></span>
<span class="r-in"><span><span class="fu"><a href="nplot.html">nplot</a></span><span class="op">(</span><span class="va">dnn2</span><span class="op">$</span><span class="va">model</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, bias<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="SEMdnn-17.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#str(dnn2, max.level=2)</span></span></span>
<span class="r-in"><span><span class="va">dnn2</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">fitIdx</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        logL        amse        rmse        srmr </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -20.7894493   0.4122892   0.6420975   0.1721242 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dnn2</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">Psi</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.4122892</span>
<span class="r-in"><span><span class="va">dnn2</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">parameterEstimates</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $beta</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      lhs op  rhs weight</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  10452  ~ 6647 -0.035</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  10452  ~  581  0.228</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  10452  ~  572  0.244</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  10452  ~  598 -0.149</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  10452  ~  317 -0.666</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  10452  ~ 5630 -0.045</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  84134  ~ 6647  0.088</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  84134  ~  581 -0.066</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  84134  ~  572  0.350</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 84134  ~  598 -0.218</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 84134  ~  317 -0.461</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12 84134  ~ 5630 -0.111</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13   836  ~ 6647  0.314</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14   836  ~  581 -0.193</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15   836  ~  572 -0.108</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16   836  ~  598  0.045</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17   836  ~  317  0.390</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18   836  ~ 5630 -0.023</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19  4747  ~ 6647  0.345</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20  4747  ~  581 -0.115</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21  4747  ~  572  0.083</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22  4747  ~  598 -0.249</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23  4747  ~  317 -0.534</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24  4747  ~ 5630 -0.126</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25  4741  ~ 6647  0.213</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26  4741  ~  581 -0.213</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27  4741  ~  572  0.128</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28  4741  ~  598 -0.221</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29  4741  ~  317 -0.391</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30  4741  ~ 5630 -0.178</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31  4744  ~ 6647  0.061</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32  4744  ~  581 -0.258</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33  4744  ~  572  0.187</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 34  4744  ~  598 -0.216</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 35  4744  ~  317 -0.340</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36  4744  ~ 5630 -0.184</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 37 79139  ~ 6647  0.454</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 38 79139  ~  581 -0.115</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 39 79139  ~  572 -0.129</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 40 79139  ~  598  0.027</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 41 79139  ~  317  0.237</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 42 79139  ~ 5630 -0.050</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 43  5530  ~ 6647  0.258</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44  5530  ~  581 -0.433</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 45  5530  ~  572  0.015</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 46  5530  ~  598 -0.265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 47  5530  ~  317 -0.141</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 48  5530  ~ 5630 -0.058</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 49  5532  ~ 6647  0.362</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 50  5532  ~  581 -0.317</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 51  5532  ~  572  0.066</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 52  5532  ~  598 -0.236</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 53  5532  ~  317 -0.252</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 54  5532  ~ 5630 -0.143</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 55  5533  ~ 6647 -0.277</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 56  5533  ~  581 -0.288</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 57  5533  ~  572  0.082</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 58  5533  ~  598 -0.037</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 59  5533  ~  317  0.249</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 60  5533  ~ 5630  0.006</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 61  5534  ~ 6647  0.281</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 62  5534  ~  581 -0.407</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 63  5534  ~  572  0.076</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 64  5534  ~  598 -0.235</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 65  5534  ~  317 -0.155</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 66  5534  ~ 5630 -0.154</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 67  5535  ~ 6647 -0.429</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 68  5535  ~  581 -0.409</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 69  5535  ~  572  0.255</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 70  5535  ~  598 -0.145</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 71  5535  ~  317 -0.022</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 72  5535  ~ 5630 -0.168</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $psi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     10452     84134       836      4747      4741      4744     79139      5530 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.3307411 0.4487222 0.4342944 0.3591278 0.5002030 0.5840391 0.4555874 0.3116142 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      5532      5533      5534      5535 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.3281222 0.5790221 0.2464519 0.3695451 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu">gplot</span><span class="op">(</span><span class="va">dnn2</span><span class="op">$</span><span class="va">graph</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="SEMdnn-18.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu">E</span><span class="op">(</span><span class="va">dnn2</span><span class="op">$</span><span class="va">graph</span><span class="op">)</span><span class="op">$</span><span class="va">color</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     gray50       red2 royalblue3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         36         14         22 </span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Mario Grassi, Barbara Tarantino.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

